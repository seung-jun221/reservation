<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>VIP 설명회 통합 모니터링 - i.study</title>

    <!-- Supabase 클라이언트 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Chart.js (중요: 반드시 먼저 로드) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- CSS 파일 -->
    <link rel="stylesheet" href="assets/css/monitoring-v3.css" />

    <!-- 파비콘 -->
    <link rel="icon" href="data:," />
  </head>
  <body>
    <!-- 글로벌 헤더 -->
    <header class="global-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="header-title">VIP 설명회 통합 모니터링</h1>
          <span class="connection-status" id="connectionStatus">
            <span class="status-dot"></span>
            <span class="status-text">연결중...</span>
          </span>
        </div>

        <!-- 설명회 선택기 -->
        <div class="seminar-selector">
          <label for="globalSeminarFilter">설명회:</label>
          <select id="globalSeminarFilter">
            <option value="all">📊 전체 설명회</option>
            <!-- 동적으로 추가됨 -->
          </select>
        </div>

        <div class="header-right">
          <button class="btn-refresh" onclick="MonitoringApp.refreshData()">
            🔄 새로고침
          </button>
          <span class="last-update" id="lastUpdate">-</span>
        </div>
      </div>
    </header>

    <!-- 탭 네비게이션 -->
    <nav class="tab-navigation">
      <button
        class="tab-btn active"
        data-tab="dashboard"
        onclick="MonitoringApp.switchTab('dashboard')"
      >
        📊 통합 대시보드
      </button>
      <button
        class="tab-btn"
        data-tab="reservations"
        onclick="MonitoringApp.switchTab('reservations')"
      >
        📋 설명회 예약
      </button>
      <button
        class="tab-btn"
        data-tab="checkin"
        onclick="MonitoringApp.switchTab('checkin')"
      >
        ✅ 체크인 분석
      </button>
      <button
        class="tab-btn"
        data-tab="test"
        onclick="MonitoringApp.switchTab('test')"
      >
        📝 진단검사 신청
      </button>
      <button
        class="tab-btn"
        data-tab="consulting"
        onclick="MonitoringApp.switchTab('consulting')"
      >
        💼 컨설팅 신청
      </button>
    </nav>

    <!-- 메인 컨테이너 -->
    <main class="main-container">
      <!-- 1. 통합 대시보드 -->
      <section id="dashboard-tab" class="tab-content active">
        <div class="dashboard-grid">
          <!-- 통계 카드 -->
          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-icon">📋</div>
              <div class="stat-content">
                <div class="stat-value" id="totalReservations">0</div>
                <div class="stat-label">총 예약</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">✅</div>
              <div class="stat-content">
                <div class="stat-value" id="totalCheckins">0</div>
                <div class="stat-label">체크인 완료</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">📝</div>
              <div class="stat-content">
                <div class="stat-value" id="totalTests">0</div>
                <div class="stat-label">진단검사 신청</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">💼</div>
              <div class="stat-content">
                <div class="stat-value" id="totalConsulting">0</div>
                <div class="stat-label">컨설팅 예약</div>
              </div>
            </div>
          </div>

          <!-- 전환율 차트 -->
          <div class="chart-container">
            <h3>전환 퍼널 분석</h3>
            <canvas id="funnelChart"></canvas>
          </div>

          <!-- 최근 활동 -->
          <div class="recent-activity">
            <h3>최근 활동</h3>
            <div id="recentActivityList" class="activity-list">
              <!-- 동적으로 추가됨 -->
            </div>
          </div>
        </div>
      </section>

      <!-- 2. 설명회 예약 -->
      <section id="reservations-tab" class="tab-content">
        <div class="section-header">
          <h2>설명회 예약 현황</h2>
          <div class="filter-controls">
            <select id="statusFilter">
              <option value="">전체 상태</option>
              <option value="예약">예약</option>
              <option value="참석">참석</option>
              <option value="취소">취소</option>
              <option value="노쇼">노쇼</option>
            </select>
            <input
              type="text"
              id="searchInput"
              placeholder="이름, 전화번호, 학교 검색..."
            />
          </div>
        </div>

        <div class="table-container">
          <table class="data-table" id="reservationsTable">
            <thead>
              <tr>
                <th>No</th>
                <th>설명회</th>
                <th>학생명</th>
                <th>연락처</th>
                <th>학교</th>
                <th>학년</th>
                <th>상태</th>
                <th>체크인</th>
                <th>등록일시</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="reservationsTableBody">
              <!-- 동적으로 추가됨 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 3. 체크인 분석 -->
      <section id="checkin-tab" class="tab-content">
        <div class="section-header">
          <h2>체크인 분석</h2>
        </div>

        <!-- 체크인 통계 -->
        <div class="checkin-stats">
          <div class="checkin-stat-card">
            <h4>총 체크인</h4>
            <div class="checkin-value" id="checkinTotal">0</div>
          </div>
          <div class="checkin-stat-card">
            <h4>진단검사 선택</h4>
            <div class="checkin-value" id="checkinTest">0</div>
            <div class="checkin-percent" id="checkinTestPercent">0%</div>
          </div>
          <div class="checkin-stat-card">
            <h4>컨설팅 선택</h4>
            <div class="checkin-value" id="checkinConsult">0</div>
            <div class="checkin-percent" id="checkinConsultPercent">0%</div>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table" id="checkinTable">
            <thead>
              <tr>
                <th>체크인 시간</th>
                <th>학생명</th>
                <th>설명회</th>
                <th>체크인 유형</th>
                <th>선택 항목</th>
              </tr>
            </thead>
            <tbody id="checkinTableBody">
              <!-- 동적으로 추가됨 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 4. 진단검사 신청 -->
      <section id="test-tab" class="tab-content">
        <div class="section-header">
          <h2>진단검사 신청 현황</h2>
          <div class="filter-controls">
            <select id="testTypeFilter">
              <option value="">전체 유형</option>
              <option value="HME">HME</option>
              <option value="MONO">MONO</option>
              <option value="TRI">TRI</option>
              <option value="MOCK">모의고사</option>
            </select>
          </div>
        </div>

        <!-- 진단검사 통계 -->
        <div class="test-stats">
          <div class="test-stat-card">
            <h4>총 신청</h4>
            <div class="test-value" id="testTotal">0</div>
          </div>
          <div class="test-stat-card">
            <h4>다운로드 완료</h4>
            <div class="test-value" id="testDownloaded">0</div>
            <div class="test-percent" id="testDownloadPercent">0%</div>
          </div>
          <div class="test-stat-card">
            <h4>컨설팅 전환</h4>
            <div class="test-value" id="testConverted">0</div>
            <div class="test-percent" id="testConvertPercent">0%</div>
          </div>
        </div>

        <div class="table-container">
          <table class="data-table" id="testTable">
            <thead>
              <tr>
                <th>No</th>
                <th>설명회</th>
                <th>학생명</th>
                <th>학교</th>
                <th>학년</th>
                <th>검사유형</th>
                <th>다운로드</th>
                <th>컨설팅예약</th>
                <th>신청일시</th>
              </tr>
            </thead>
            <tbody id="testTableBody">
              <!-- 동적으로 추가됨 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 5. 컨설팅 신청 -->
      <section id="consulting-tab" class="tab-content">
        <div class="section-header">
          <h2>컨설팅 예약 현황</h2>
          <div class="view-switcher">
            <button
              class="view-btn active"
              onclick="MonitoringApp.switchConsultingView('calendar')"
            >
              📅 캘린더 뷰
            </button>
            <button
              class="view-btn"
              onclick="MonitoringApp.switchConsultingView('list')"
            >
              📋 리스트 뷰
            </button>
          </div>
        </div>

        <!-- 컨설팅 통계 -->
        <div class="consulting-stats">
          <div class="consulting-stat-card">
            <h4>이번주 예약</h4>
            <div class="consulting-value" id="consultingWeek">0</div>
          </div>
          <div class="consulting-stat-card">
            <h4>오늘 예정</h4>
            <div class="consulting-value" id="consultingToday">0</div>
          </div>
          <div class="consulting-stat-card">
            <h4>완료</h4>
            <div class="consulting-value" id="consultingCompleted">0</div>
          </div>
        </div>

        <!-- 캘린더 뷰 -->
        <div id="consultingCalendar" class="consulting-calendar">
          <!-- 동적으로 생성됨 -->
        </div>

        <!-- 리스트 뷰 -->
        <div id="consultingList" class="consulting-list" style="display: none">
          <table class="data-table">
            <thead>
              <tr>
                <th>날짜</th>
                <th>시간</th>
                <th>학생명</th>
                <th>학교</th>
                <th>학년</th>
                <th>진단검사</th>
                <th>상태</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="consultingTableBody">
              <!-- 동적으로 추가됨 -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>데이터를 불러오는 중...</p>
      </div>
    </div>

    <!-- 토스트 메시지 -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- JavaScript 파일들 -->
    <script src="assets/js/monitoring-core.js"></script>
    <script src="assets/js/monitoring-modules.js"></script>
    <script src="assets/js/monitoring-app.js"></script>
  </body>
</html>
