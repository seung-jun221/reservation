<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>VIP 설명회 통합 모니터링 - i.study</title>

    <!-- Supabase 클라이언트 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Chart.js for dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- CSS 파일 -->
    <link rel="stylesheet" href="assets/css/monitoring-v3.css?v=20250103" />

    <!-- 파비콘 -->
    <link rel="icon" href="data:," />
  </head>
  <body>
    <!-- 글로벌 헤더 -->
    <header class="global-header">
      <div class="header-content">
        <div class="header-left">
          <h1 class="header-title">VIP 설명회 통합 모니터링</h1>
          <span class="connection-status" id="connectionStatus">
            <span class="status-dot connected"></span>
            <span class="status-text">실시간</span>
          </span>
        </div>

        <!-- 설명회 선택기 -->
        <div class="seminar-selector">
          <label for="globalSeminarFilter" class="selector-label"
            >설명회:</label
          >
          <select id="globalSeminarFilter" class="seminar-dropdown">
            <option value="all">📊 전체 설명회</option>
            <option value="divider" disabled>──────────────</option>
          </select>
          <span class="selected-badge" id="selectedBadge">전체</span>
        </div>

        <div class="header-right">
          <button
            class="icon-btn"
            onclick="MonitoringCore.refreshData()"
            title="새로고침"
          >
            <span class="refresh-icon">↻</span>
          </button>
          <button
            class="icon-btn"
            onclick="MonitoringCore.exportData()"
            title="엑셀 다운로드"
          >
            <span>📥</span>
          </button>
        </div>
      </div>
    </header>

    <!-- 탭 네비게이션 -->
    <nav class="tab-navigation">
      <button
        class="tab-btn active"
        data-tab="dashboard"
        onclick="MonitoringCore.switchTab('dashboard')"
      >
        📊 통합 대시보드
      </button>
      <button
        class="tab-btn"
        data-tab="seminar"
        onclick="MonitoringCore.switchTab('seminar')"
      >
        📋 설명회 예약
      </button>
      <button
        class="tab-btn"
        data-tab="checkin"
        onclick="MonitoringCore.switchTab('checkin')"
      >
        ✅ 체크인 분석
      </button>
      <button
        class="tab-btn"
        data-tab="test"
        onclick="MonitoringCore.switchTab('test')"
      >
        📝 진단검사 신청
      </button>
      <button
        class="tab-btn"
        data-tab="consulting"
        onclick="MonitoringCore.switchTab('consulting')"
      >
        💼 컨설팅 신청
      </button>
    </nav>

    <!-- 메인 컨테이너 -->
    <main class="main-container">
      <!-- 통합 대시보드 -->
      <section id="dashboard-tab" class="tab-content active">
        <div class="dashboard-header">
          <h2>📊 통합 대시보드</h2>
          <div class="period-selector">
            <button class="period-btn active">오늘</button>
            <button class="period-btn">이번주</button>
            <button class="period-btn">이번달</button>
            <button class="period-btn">전체</button>
          </div>
        </div>

        <!-- 통계 카드 -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">📋</div>
            <div class="stat-info">
              <div class="stat-value" id="total-reservations">0</div>
              <div class="stat-label">총 예약</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">✅</div>
            <div class="stat-info">
              <div class="stat-value" id="total-checkins">0</div>
              <div class="stat-label">체크인 완료</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">📝</div>
            <div class="stat-info">
              <div class="stat-value" id="total-tests">0</div>
              <div class="stat-label">진단검사 신청</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">💼</div>
            <div class="stat-info">
              <div class="stat-value" id="total-consultings">0</div>
              <div class="stat-label">컨설팅 예약</div>
            </div>
          </div>
        </div>

        <!-- 전환율 차트 -->
        <div class="chart-container">
          <h3>전환 퍼널 분석</h3>
          <canvas id="funnelChart"></canvas>
        </div>

        <!-- 설명회별 분석 -->
        <div id="seminar-analysis" class="seminar-analysis-section">
          <!-- 동적 생성 -->
        </div>

        <!-- 최근 활동 -->
        <div class="recent-activities">
          <h3>최근 활동</h3>
          <div id="activityList" class="activity-list">
            <!-- 동적 생성 -->
          </div>
        </div>
      </section>

      <!-- 설명회 예약 -->
      <section id="seminar-tab" class="tab-content">
        <div class="section-header">
          <h2>설명회 예약 현황</h2>
          <div class="filter-bar">
            <select id="seminarStatusFilter">
              <option value="">전체 상태</option>
              <option value="예약">예약</option>
              <option value="참석">참석</option>
              <option value="취소">취소</option>
              <option value="노쇼">노쇼</option>
            </select>
            <input
              type="text"
              id="seminarSearchInput"
              placeholder="이름, 학교, 연락처 검색..."
            />
            <button
              class="btn btn-primary"
              onclick="SeminarModule.renderTable()"
            >
              검색
            </button>
          </div>
        </div>

        <!-- 설명회별 통계 -->
        <div id="seminarStats" class="seminar-stats">
          <!-- 동적 생성 -->
        </div>

        <!-- 예약 리스트 -->
        <div class="table-container">
          <table class="data-table" id="seminarTable">
            <thead>
              <tr>
                <th>No</th>
                <th>설명회</th>
                <th>학생명</th>
                <th>학교</th>
                <th>학년</th>
                <th>상태</th>
                <th>체크인</th>
                <th>예약일시</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="seminarTableBody">
              <!-- 동적 생성 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 체크인 분석 -->
      <section id="checkin-tab" class="tab-content">
        <div class="section-header">
          <h2>체크인 분석</h2>
        </div>

        <!-- 체크인 통계 -->
        <div class="checkin-stats-grid">
          <div class="checkin-stat-card total">
            <div class="checkin-stat-icon">👥</div>
            <div class="checkin-stat-content">
              <div class="checkin-stat-value" id="checkin-total">0</div>
              <div class="checkin-stat-label">총 체크인</div>
            </div>
          </div>
          <div class="checkin-stat-card test">
            <div class="checkin-stat-icon">📝</div>
            <div class="checkin-stat-content">
              <div class="checkin-stat-value" id="checkin-test">0</div>
              <div class="checkin-stat-label">진단검사 선택</div>
              <div class="checkin-stat-rate" id="checkin-test-rate">0%</div>
            </div>
          </div>
          <div class="checkin-stat-card consult">
            <div class="checkin-stat-icon">💼</div>
            <div class="checkin-stat-content">
              <div class="checkin-stat-value" id="checkin-consult">0</div>
              <div class="checkin-stat-label">컨설팅 선택</div>
              <div class="checkin-stat-rate" id="checkin-consult-rate">0%</div>
            </div>
          </div>
          <div class="checkin-stat-card pending">
            <div class="checkin-stat-icon">⏳</div>
            <div class="checkin-stat-content">
              <div class="checkin-stat-value" id="checkin-pending">0</div>
              <div class="checkin-stat-label">미선택</div>
              <div class="checkin-stat-rate" id="checkin-pending-rate">0%</div>
            </div>
          </div>
        </div>

        <!-- 전환율 차트 -->
        <div id="checkin-conversion-chart" class="conversion-chart">
          <!-- 동적 생성 -->
        </div>

        <!-- 체크인 리스트 -->
        <div class="table-container">
          <table class="data-table" id="checkinTable">
            <thead>
              <tr>
                <th>체크인 시간</th>
                <th>학생명</th>
                <th>설명회</th>
                <th>체크인 유형</th>
                <th>선택 항목</th>
                <th>선택 시간</th>
              </tr>
            </thead>
            <tbody id="checkinTableBody">
              <!-- 동적 생성 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 진단검사 신청 -->
      <section id="test-tab" class="tab-content">
        <div class="section-header">
          <h2>진단검사 신청 현황</h2>
          <div class="filter-bar">
            <select id="testSeminarFilter">
              <option value="">전체 설명회</option>
            </select>
            <select id="testTypeFilter">
              <option value="">전체 유형</option>
              <option value="HME">HME</option>
              <option value="MONO">MONO</option>
              <option value="TRI">TRI</option>
              <option value="MOCK">모의고사</option>
            </select>
            <input
              type="text"
              id="testSearchInput"
              placeholder="이름, 학교 검색..."
            />
            <button class="btn btn-primary" onclick="TestModule.renderTable()">
              검색
            </button>
          </div>
        </div>

        <!-- 진단검사 통계 -->
        <div class="test-stats">
          <div class="test-stat-card">
            <span class="test-stat-label">총 신청</span>
            <span class="test-stat-value" id="test-total">0</span>
          </div>
          <div class="test-stat-card">
            <span class="test-stat-label">HME</span>
            <span class="test-stat-value" id="test-hme">0</span>
          </div>
          <div class="test-stat-card">
            <span class="test-stat-label">MONO/TRI</span>
            <span class="test-stat-value" id="test-mono-tri">0</span>
          </div>
          <div class="test-stat-card">
            <span class="test-stat-label">모의고사</span>
            <span class="test-stat-value" id="test-mock">0</span>
          </div>
          <div class="test-stat-card">
            <span class="test-stat-label" id="test-download-rate"
              >다운로드 완료: 0명 (0%)</span
            >
          </div>
        </div>

        <!-- 진단검사 신청 리스트 -->
        <div class="table-container">
          <table class="data-table" id="testTable">
            <thead>
              <tr>
                <th>No</th>
                <th>설명회</th>
                <th>학생명</th>
                <th>학교</th>
                <th>학년</th>
                <th>수학선행</th>
                <th>검사유형</th>
                <th>다운로드</th>
                <th>신청일시</th>
              </tr>
            </thead>
            <tbody id="testTableBody">
              <!-- 동적 생성 -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- 컨설팅 신청 -->
      <section id="consulting-tab" class="tab-content">
        <div class="section-header">
          <h2>컨설팅 예약 현황</h2>
          <div class="view-switcher">
            <button
              class="view-btn active"
              onclick="ConsultingModule.switchView('calendar')"
            >
              📅 캘린더 뷰
            </button>
            <button
              class="view-btn"
              onclick="ConsultingModule.switchView('list')"
            >
              📋 리스트 뷰
            </button>
          </div>
        </div>

        <!-- 컨설팅 통계 -->
        <div class="consulting-stats">
          <div class="consulting-stat">
            <span class="label">이번 주 예약</span>
            <span class="value" id="consulting-week">0</span>
          </div>
          <div class="consulting-stat">
            <span class="label">오늘 예약</span>
            <span class="value" id="consulting-today">0</span>
          </div>
          <div class="consulting-stat">
            <span class="label">대기중</span>
            <span class="value" id="consulting-pending">0</span>
          </div>
          <div class="consulting-stat">
            <span class="label" id="consulting-completion-rate"
              >완료율: 0%</span
            >
          </div>
        </div>

        <!-- 캘린더 뷰 -->
        <div id="consultingCalendar" class="consulting-calendar">
          <!-- 동적 생성 -->
        </div>

        <!-- 리스트 뷰 -->
        <div id="consultingList" class="consulting-list" style="display: none">
          <table class="data-table">
            <thead>
              <tr>
                <th>날짜</th>
                <th>시간</th>
                <th>학생명</th>
                <th>학교</th>
                <th>학년</th>
                <th>진단검사</th>
                <th>상태</th>
                <th>액션</th>
              </tr>
            </thead>
            <tbody id="consultingTableBody">
              <!-- 동적 생성 -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- 로딩 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="loading-content">
        <div class="spinner"></div>
        <p>데이터를 불러오는 중...</p>
      </div>
    </div>

    <!-- 토스트 메시지 컨테이너 -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- 모달 (예약 상세, 수정 등) -->
    <div id="modalOverlay" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">상세 정보</h3>
          <button class="modal-close" onclick="closeModal()">×</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- 동적 생성 -->
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal()">닫기</button>
          <button
            class="btn btn-primary"
            id="modalSaveBtn"
            style="display: none"
          >
            저장
          </button>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/monitoring-v3.js?v=20250103"></script>
    <script src="assets/js/monitoring-modules.js?v=20250103"></script>
  </body>
</html>
